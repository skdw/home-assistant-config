- id: 'lights_switch2light'
  alias: YAML Lights - On switch toggle light
  trigger_variables:
    lights: &Lights !include ../entities/lights.yaml
    switches: &Switches !include ../entities/switches.yaml
  mode: parallel
  max: 20
  triggers:
  - alias: Switch state changed
    trigger: state
    entity_id: *Switches
  condition:
  - alias: Initial light and switch states match
    condition: template
    value_template: "{{ states(lights[switches.index(trigger.entity_id)]) == trigger.from_state.state }}"
  - alias: Target state is defined
    condition: template
    value_template: "{{ trigger.to_state.state in ['on', 'off'] }}"
  action:
  - alias: Toggle light
    service: "light.turn_{{ trigger.to_state.state }}"
    target:
      entity_id: "{{ lights[switches.index(trigger.entity_id)] }}"
- id: 'lights_light2switch'
  alias: YAML Lights - On light toggle switch
  trigger_variables:
    lights: *Lights
    switches: *Switches
  mode: parallel
  max: 20
  triggers:
  - alias: Light state changed
    trigger: state
    entity_id: *Lights
  condition:
  - alias: Initial switch and light states match
    condition: template
    value_template: "{{ states(switches[lights.index(trigger.entity_id)]) == trigger.from_state.state }}"
  - alias: Target state is defined
    condition: template
    value_template: "{{ trigger.to_state.state in ['on', 'off'] }}"
  action:
  - alias: Toggle switch
    service: "switch.turn_{{ trigger.to_state.state }}"
    target:
      entity_id: "{{ switches[lights.index(trigger.entity_id)] }}"
