- id: 'switch2light'
  alias: YAML Lights - On switch toggle light
  variables:
    lights: !include variables_lights.yaml
    switches: !include variables_switches.yaml
  mode: parallel
  trigger:
  - platform: state
    entity_id: !include variables_switches.yaml
  condition:
  - condition: template # automate only if initial light and switch states match
    value_template: "{{ states(lights[switches.index(trigger.entity_id)]) == trigger.from_state.state }}"
  action:
  - service: "{{ 'light.turn_on' if(trigger.to_state.state == 'on') else 'light.turn_off' }}"
    target:
      entity_id: "{{ lights[switches.index(trigger.entity_id)] }}"
- id: 'light2switch'
  alias: YAML Lights - On light toggle switch
  variables:
    lights: !include variables_lights.yaml
    switches: !include variables_switches.yaml
  mode: parallel
  trigger:
  - platform: state
    entity_id: !include variables_lights.yaml
  condition:
  - condition: template # automate only if initial switch and light states match
    value_template: "{{ states(switches[lights.index(trigger.entity_id)]) == trigger.from_state.state }}"
  action:
  - service: "{{ 'switch.turn_on' if(trigger.to_state.state == 'on') else 'switch.turn_off' }}"
    target:
      entity_id: "{{ switches[lights.index(trigger.entity_id)] }}"

